const Bt="modulepreload",$t=function(t){return"/"+t},at={},lt=function(e,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),i=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));a=Promise.allSettled(r.map(o=>{if(o=$t(o),o in at)return;at[o]=!0;const s=o.endsWith(".css"),l=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${l}`))return;const u=document.createElement("link");if(u.rel=s?"stylesheet":Bt,s||(u.as="script"),u.crossOrigin="",u.href=o,i&&u.setAttribute("nonce",i),document.head.appendChild(u),s)return new Promise((m,v)=>{u.addEventListener("load",m),u.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${o}`)))})}))}function d(g){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=g,window.dispatchEvent(i),!i.defaultPrevented)throw g}return a.then(g=>{for(const i of g||[])i.status==="rejected"&&d(i.reason);return e().catch(d)})},p={};function Pt(){Object.assign(p,{layoutModeBtn:document.getElementById("layout-mode-btn"),stitchingModeBtn:document.getElementById("stitching-mode-btn"),layoutControls:document.getElementById("layout-controls"),layoutContainer:document.getElementById("layout-container"),stitchingControls:document.getElementById("stitching-controls"),stitchingDirectionBtns:document.getElementById("stitching-direction-btns"),stitchingUploadBtn:document.getElementById("stitching-upload-btn"),stitchingUploadInput:document.getElementById("stitching-upload-input"),layoutWrapper:document.getElementById("layout-wrapper"),layoutGrid:document.getElementById("layout-grid"),stitchingWrapper:document.getElementById("stitching-wrapper"),stitchingGrid:document.getElementById("stitching-grid"),canvasHint:document.getElementById("canvas-hint"),canvasSettings:document.getElementById("canvas-settings"),aspectRatioBtns:document.getElementById("aspect-ratio-btns"),spacingSlider:document.getElementById("spacing-slider"),spacingValue:document.getElementById("spacing-value"),radiusSlider:document.getElementById("radius-slider"),radiusValue:document.getElementById("radius-value"),colorPicker:document.getElementById("color-picker"),shuffleBtn:document.getElementById("shuffle-btn"),downloadBtn:document.getElementById("download-btn"),borderTopInput:document.getElementById("border-top-input"),borderRightInput:document.getElementById("border-right-input"),borderBottomInput:document.getElementById("border-bottom-input"),borderLeftInput:document.getElementById("border-left-input"),borderControls:document.getElementById("border-controls"),toast:document.getElementById("toast")})}function w(t,e){const r=document.createElement(t);return e&&(r.className=e),r}const H={upload:'<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',remove:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',replace:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>',zoomIn:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomOut:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>',zoomReset:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="4"></circle></svg>'},Q={"2-t1b1":{g:2,gr:[2,1],c:[{r:1,c:1},{r:1,c:1}]},"2-l1r1":{g:2,gr:[1,2],c:[{r:1,c:1},{r:1,c:1}]},"3-t1b2":{g:3,gr:[2,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"3-t2b1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"3-l1r2":{g:3,gr:[2,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"3-l2r1":{g:3,gr:[2,2],c:[{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"3-l1rr":{g:3,gr:[3,3],c:[{r:3,c:2},{r:1,c:1},{r:2,c:1}]},"3-t1bb":{g:3,gr:[3,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:2}]},"4-grid":{g:4,gr:[2,2]},"4-t1b3":{g:4,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-b1t3":{g:4,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"4-l1r3":{g:4,gr:[3,2],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"4-l-feat":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"4-r-feat":{g:4,gr:[2,3],c:[{r:1,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1,s:[2,1]}]},"4-121":{g:4,gr:[3,2],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"4-212":{g:4,gr:[2,3],c:[{r:2,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"4-g3x2-alt":{g:4,gr:[3,2],c:[{r:2,c:1},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[1,2]},{r:2,c:1,s:[2,2]}]},"5-center":{g:5,gr:[3,3],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:2}]},"5-l3r2":{g:5,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"5-131":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1}]},"5-l2r3":{g:5,gr:[3,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t2b3":{g:5,gr:[2,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-center-h-bar":{g:5,gr:[3,2],c:[{r:1,c:1},{r:1,c:1,s:[1,2]},{r:1,c:2,s:[2,1]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-t2b3-split":{g:5,gr:[2,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"5-l1r4-col":{g:5,gr:[4,2],c:[{r:4,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t-feat-r":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-t1b4-grid":{g:5,gr:[3,2],c:[{r:1,c:2},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]}]},"5-r1l4-col":{g:5,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:4,c:1,s:[1,2]}]},"5-cross-center":{g:5,gr:[3,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:3,s:[3,1]},{r:1,c:1,s:[2,2]}]},"5-l-tall-r-split":{g:5,gr:[3,3],c:[{r:3,c:1},{r:1,c:2},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:2,s:[3,2]}]},"5-213":{g:5,gr:[2,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"5-123":{g:5,gr:[2,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"6-g3x2":{g:6,gr:[3,2]},"6-g2x3":{g:6,gr:[2,3]},"6-center":{g:6,gr:[4,4],c:[{r:1,c:3},{r:2,c:1},{r:3,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:2}]},"6-123":{g:6,gr:[3,6],c:[{r:1,c:6},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"6-321":{g:6,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:6}]},"6-231":{g:6,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:6}]},"6-222":{g:6,gr:[3,3],c:[{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1}]},"6-1133":{g:6,gr:[4,3],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"6-223r":{g:6,gr:[3,3],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-223l":{g:6,gr:[3,3],c:[{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-114":{g:6,gr:[3,5],c:[{r:2,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"6-3333":{g:6,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:2}]},"7-main":{g:7,gr:[4,4],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-h-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-w-center-band":{g:7,gr:[3,3],c:[{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-l":{g:7,gr:[4,2],c:[{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-feat-t":{g:7,gr:[4,2],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:1,c:1}]},"7-311":{g:7,gr:[3,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-113":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:3}]},"7-232":{g:7,gr:[3,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3}]},"7-124":{g:7,gr:[3,4],c:[{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-323":{g:7,gr:[3,4],c:[{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-313":{g:7,gr:[4,3],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"7-331":{g:7,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:3},{r:1,c:1},{r:1,c:1}]},"7-233":{g:7,gr:[4,6],c:[{r:2,c:3},{r:2,c:3},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"7-333":{g:7,gr:[3,3],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"7-346":{g:7,gr:[4,6],c:[{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:3},{r:1,c:3},{r:1,c:3}]},"8-g4x2":{g:8,gr:[4,2]},"8-g2x4":{g:8,gr:[2,4]},"8-222":{g:8,gr:[4,4],c:[{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:2}]},"8-l2-tall-r6-grid":{g:8,gr:[3,4],c:[{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-sandwich-6":{g:8,gr:[4,3],c:[{r:1,c:3},{r:1,c:1,s:[2,1]},{r:1,c:1,s:[2,2]},{r:1,c:1,s:[2,3]},{r:1,c:1,s:[3,1]},{r:1,c:1,s:[3,2]},{r:1,c:1,s:[3,3]},{r:1,c:3,s:[4,1]}]},"8-313":{g:8,gr:[5,4],c:[{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2}]},"8-131":{g:8,gr:[4,5],c:[{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:1,c:1}]},"8-134":{g:8,gr:[4,4],c:[{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"8-431":{g:8,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1}]},"8-323":{g:8,gr:[3,6],c:[{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"8-363":{g:8,gr:[6,3],c:[{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1},{r:2,c:1},{r:3,c:1},{r:2,c:1},{r:2,c:1}]},"8-344":{g:8,gr:[4,4],c:[{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:1,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1}]},"9-grid":{g:9,gr:[3,3]},"9-144-grid":{g:9,gr:[3,4],c:[{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-414-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-441-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:4}]},"9-211-grid":{g:9,gr:[3,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-112-grid":{g:9,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"9-434-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:4,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-344-grid":{g:9,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-424-grid":{g:9,gr:[4,4],c:[{r:2,c:2},{r:2,c:1},{r:2,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1}]},"9-116-grid":{g:9,gr:[6,6],c:[{r:3,c:3},{r:3,c:3},{r:3,c:3},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"9-611-grid":{g:9,gr:[6,6],c:[{r:2,c:2},{r:1,c:1},{r:3,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:3,c:3},{r:3,c:3}]},"9-cen-grid":{g:9,gr:[4,4],c:[{r:1,c:2},{r:1,c:2},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-g5x2":{g:10,gr:[5,2]},"10-t2b8-grid":{g:10,gr:[3,4],c:[{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-424-grid":{g:10,gr:[3,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x3-grid":{g:10,gr:[4,3],c:[{r:1,c:3},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-5x5-grid":{g:10,gr:[5,5],c:[{r:4,c:4},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-4x4-grid":{g:10,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"10-8x8-grid":{g:10,gr:[8,8],c:[{r:4,c:4},{r:4,c:4},{r:4,c:4},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-442-grid":{g:10,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"10-6x6-grid":{g:10,gr:[6,6],c:[{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:1,c:2},{r:2,c:2},{r:2,c:2},{r:2,c:2}]},"11-4c4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:2},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-4x4-t":{g:11,gr:[4,4],c:[{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1}]},"11-4x6-t":{g:11,gr:[4,6],c:[{r:1,c:3},{r:1,c:3},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2},{r:1,c:2}]},"11-feat-t":{g:11,gr:[3,5],c:[{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-c":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"11-feat-f":{g:11,gr:[3,5],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:5}]},"12-g4x3":{g:12,gr:[4,3]},"12-g3x4":{g:12,gr:[3,4]},"12-g6x6":{g:12,gr:[6,6],c:[{r:5,c:5},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-feat-c":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-211":{g:13,gr:[4,4],c:[{r:2,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"13-112":{g:13,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:2},{r:1,c:1},{r:1,c:1}]},"14-g7x2":{g:14,gr:[7,2]},"14-g4x4r":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"14-g4x4c":{g:14,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:2,c:1},{r:2,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g5x3":{g:15,gr:[5,3]},"15-g4x4c":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1}]},"15-g4x4f":{g:15,gr:[4,4],c:[{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:1},{r:1,c:2}]},"16-g4x4":{g:16,gr:[4,4]}},dt="2-t1b1",c={currentMode:"layout",shared:{spacing:10,radius:8,bgColor:"#FFFFFF",backgroundImage:null,borderWidths:{top:0,right:0,bottom:0,left:0},downloadQuality:"high-jpg",selectedTextId:null,selectedArrowId:null,selectedRectangleId:null,selectedEllipseId:null},layout:{activeCellId:null,currentLayoutId:dt,layoutDef:Q[dt],imagesData:{},texts:[],arrows:[],rectangles:[],ellipses:[],colFractions:[],rowFractions:[]},stitching:{direction:"horizontal",images:[],texts:[],arrows:[],rectangles:[],ellipses:[]}};function Mt(t){c.layout.currentLayoutId=t,c.layout.layoutDef=Q[t]}const X={start(t,e){t.preventDefault(),t.stopPropagation();const r=t.type.startsWith("touch"),n=r?t.touches[0]:t,a={startX:n.clientX,startY:n.clientY,initialState:e.getInitialState?e.getInitialState():{}};e.onStart&&e.onStart(a);const d=i=>{i.preventDefault();const o=i.type.startsWith("touch")?i.touches[0]:i;e.onMove&&e.onMove(o,a)},g=()=>{document.removeEventListener(r?"touchmove":"mousemove",d),document.removeEventListener(r?"touchend":"mouseup",g),e.onEnd&&e.onEnd()};document.addEventListener(r?"touchmove":"mousemove",d,{passive:!1}),document.addEventListener(r?"touchend":"mouseup",g)}};function nt(t,e){if(!e)return;const r=w("div","text-element-container");r.id=`text-container-${t.id}`,Object.assign(r.style,{top:`${t.top}%`,left:`${t.left}%`,transform:"translate(-50%, -50%)"});const n=w("div","text-content");n.innerText=t.content,n.contentEditable="true",Object.assign(n.style,{color:t.color,fontSize:`${t.fontSize}px`,whiteSpace:"nowrap"});const a=w("div","text-toolbar");a.innerHTML=`<input type="number" value="${t.fontSize}" data-property="fontSize" title="Font Size"><input type="color" value="${t.color}" data-property="color" title="Font Color">`;const d=w("button","delete-text-button");d.innerHTML="&times;",d.title="Delete Text",r.append(a,n,d),e.appendChild(r),r.addEventListener("click",l=>{l.stopPropagation(),W(t.id)});const g=l=>l.stopPropagation();a.addEventListener("mousedown",g),a.addEventListener("touchstart",g);const i=l=>{const u=l.target.dataset.property;u&&tt({[u]:l.target.value})};a.addEventListener("input",i),a.addEventListener("change",i),n.addEventListener("blur",()=>tt({content:n.innerText}));const o=l=>{l.stopPropagation(),l.preventDefault(),vt()};d.addEventListener("click",o),d.addEventListener("touchend",o);const s=l=>{l.target.closest(".text-toolbar")||l.target.closest(".delete-text-button")||(W(t.id),X.start(l,{getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:parseFloat(r.style.left),startTopPercent:parseFloat(r.style.top)}),onMove:(u,m)=>{const{gridRect:v,startLeftPercent:f,startTopPercent:b}=m.initialState;if(v.width===0||v.height===0)return;const L=u.clientX-m.startX,C=u.clientY-m.startY;r.style.left=`${f+L/v.width*100}%`,r.style.top=`${b+C/v.height*100}%`},onEnd:()=>{tt({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}}))};r.addEventListener("mousedown",s),r.addEventListener("touchstart",s)}function ct(t,e,r=null){if(!e)return;const n=w("div","arrow-container"),a=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","line"),g=w("div","arrow-handle"),i=w("div","arrow-handle"),o=w("div","rotation-handle"),s=w("div","text-toolbar"),l=h=>{const y=r||e.getBoundingClientRect();if(y.width===0)return;const E=y.width*(h.x1/100),S=y.height*(h.y1/100),I=y.width*(h.x2/100),x=y.height*(h.y2/100),$=Math.min(E,I),P=Math.min(S,x);Object.assign(n.style,{left:`${$}px`,top:`${P}px`,width:`${Math.abs(E-I)}px`,height:`${Math.abs(S-x)}px`,transform:`rotate(${h.rotation||0}deg)`});const z=E-$,N=S-P;d.setAttribute("x1",z),d.setAttribute("y1",N),d.setAttribute("x2",I-$),d.setAttribute("y2",x-P),d.setAttribute("stroke-width",h.strokeWidth),d.setAttribute("stroke",h.color),d.setAttribute("stroke-linecap","butt");const st=a.querySelector("marker polygon");st&&st.setAttribute("fill",h.color),g.style.left=`${z}px`,g.style.top=`${N}px`,i.style.left=`${I-$}px`,i.style.top=`${x-P}px`};n.id=`arrow-container-${t.id}`,c.shared.selectedArrowId===t.id&&n.classList.add("selected");const u=`arrowhead-${t.id}`;a.innerHTML=`<defs>
        <marker
            id="${u}"
            viewBox="0 0 12 12"
            refX="10" refY="6"
            markerWidth="9" markerHeight="9"
            orient="auto">
            <polygon points="2 2, 11 6, 2 10, 2 8, 5 6, 2 4" fill="${t.color}"></polygon>
        </marker>
    </defs>`,d.setAttribute("marker-end",`url(#${u})`),a.appendChild(d),s.style.top="-45px",s.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="Thickness" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="Color"><button class="toolbar-delete-btn" title="Delete Arrow">&times;</button>`,n.append(a,g,i,o,s),e.appendChild(n),l(t);const m=(h,y)=>{h.addEventListener("mousedown",E=>X.start(E,y)),h.addEventListener("touchstart",E=>X.start(E,y))},v=h=>h.stopPropagation();s.addEventListener("mousedown",v),s.addEventListener("touchstart",v);const f=h=>{const y={[h.target.dataset.property]:h.target.value};U(y);const E=c.layout.arrows.find(S=>S.id===t.id);E&&l(E)};s.addEventListener("input",f),s.addEventListener("change",f);const b=s.querySelector(".toolbar-delete-btn"),L=h=>{h.stopPropagation(),h.preventDefault(),bt()};b.addEventListener("click",L),b.addEventListener("touchend",L),m(n,{onStart:()=>R(t.id),getInitialState:()=>({initialData:{...t},containerStartLeft:n.offsetLeft,containerStartTop:n.offsetTop}),onMove:(h,y)=>{const E=h.clientX-y.startX,S=h.clientY-y.startY;n.style.left=`${y.initialState.containerStartLeft+E}px`,n.style.top=`${y.initialState.containerStartTop+S}px`},onEnd:()=>{const h=n.getBoundingClientRect(),y=c.layout.arrows.find(N=>N.id===t.id);if(!y)return;const E=e.getBoundingClientRect(),S=(y.x1<y.x2?y.x1:y.x2)/100*E.width,I=(y.y1<y.y2?y.y1:y.y2)/100*E.height,x=h.left-E.left-S,$=h.top-E.top-I,P=x/E.width*100,z=$/E.height*100;(Math.abs(P)>.01||Math.abs(z)>.01)&&U({x1:y.x1+P,y1:y.y1+z,x2:y.x2+P,y2:y.y2+z})}});const C=h=>({onStart:()=>R(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect()}),onMove:(y,E)=>{const{gridRect:S}=E.initialState;if(S.width===0||S.height===0)return;const I={...c.layout.arrows.find(x=>x.id===t.id)};I[h.x]=(y.clientX-S.left)/S.width*100,I[h.y]=(y.clientY-S.top)/S.height*100,U(I),l(I)},onEnd:()=>{var y;(y=k())==null||y.render()}});m(g,C({x:"x1",y:"y1"})),m(i,C({x:"x2",y:"y2"})),m(o,{onStart:()=>R(t.id),getInitialState:()=>{const h=n.getBoundingClientRect();return{centerX:h.left+h.width/2,centerY:h.top+h.height/2,initialRotation:t.rotation||0}},onMove:(h,y)=>{const{centerX:E,centerY:S,initialRotation:I}=y.initialState,x=Math.atan2(h.clientY-S,h.clientX-E)*(180/Math.PI),$=Math.atan2(y.startY-S,y.startX-E)*(180/Math.PI);n.style.transform=`rotate(${I+(x-$)}deg)`},onEnd:()=>{const h=n.style.transform,y=h?parseFloat(h.replace(/[^0-9.-]/g,"")):0;U({rotation:y})}})}function j(t,e){if(!e)return;const r=w("div","shape-container");r.id=`shape-container-${t.id}`,Object.assign(r.style,{left:`${t.left}%`,top:`${t.top}%`,width:`${t.width}%`,height:`${t.height}%`,transform:"translate(-50%, -50%)"});const n=w("div","shape-element");n.style.border=`${t.strokeWidth}px solid ${t.color}`,t.type==="ellipse"&&(n.style.borderRadius="50%");const a=w("div","shape-toolbar");a.innerHTML=`<input type="number" value="${t.strokeWidth}" data-property="strokeWidth" title="线条粗细" min="1" max="50"><input type="color" value="${t.color}" data-property="color" title="线条颜色"><button class="toolbar-delete-btn" title="删除形状">&times;</button>`;const d=["n","ne","e","se","s","sw","w","nw"].map(f=>{const b=w("div",`resize-handle ${f}`);return b.dataset.direction=f,b});r.append(n,a,...d),e.appendChild(r),(c.shared.selectedRectangleId===t.id||c.shared.selectedEllipseId===t.id)&&r.classList.add("selected");const g=t.type==="rectangle"?Y:q,i=t.type==="rectangle"?ee:ne,o=t.type==="rectangle"?wt:Et,s=(f,b)=>{f.addEventListener("mousedown",L=>X.start(L,b)),f.addEventListener("touchstart",L=>X.start(L,b))},l=f=>f.stopPropagation();a.addEventListener("mousedown",l),a.addEventListener("touchstart",l);const u=f=>{const b=f.target.type==="number"?parseFloat(f.target.value):f.target.value,L={[f.target.dataset.property]:b};i(L),n.style.borderColor=L.color||t.color,n.style.borderWidth=L.strokeWidth?`${L.strokeWidth}px`:`${t.strokeWidth}px`};a.addEventListener("input",u),a.addEventListener("change",u);const m=a.querySelector(".toolbar-delete-btn"),v=f=>{f.stopPropagation(),f.preventDefault(),o()};m.addEventListener("click",v),m.addEventListener("touchend",v),s(n,{onStart:()=>g(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeftPercent:t.left,startTopPercent:t.top}),onMove:(f,b)=>{const{gridRect:L,startLeftPercent:C,startTopPercent:h}=b.initialState;if(L.width===0||L.height===0)return;const y=f.clientX-b.startX,E=f.clientY-b.startY;r.style.left=`${C+y/L.width*100}%`,r.style.top=`${h+E/L.height*100}%`},onEnd:()=>i({left:parseFloat(r.style.left),top:parseFloat(r.style.top)})}),d.forEach(f=>{s(f,{onStart:()=>g(t.id),getInitialState:()=>({gridRect:e.getBoundingClientRect(),startLeft:t.left,startTop:t.top,startWidth:t.width,startHeight:t.height,direction:f.dataset.direction}),onMove:(b,L)=>{const{gridRect:C,direction:h,...y}=L.initialState;if(C.width===0||C.height===0)return;const E=(b.clientX-L.startX)/C.width*100,S=(b.clientY-L.startY)/C.height*100;let I=y.startLeft,x=y.startTop,$=y.startWidth,P=y.startHeight;h.includes("e")&&($+=E),h.includes("w")&&($-=E,I+=E),h.includes("s")&&(P+=S),h.includes("n")&&(P-=S,x+=S),$>1&&P>1&&(r.style.left=`${I}%`,r.style.top=`${x}%`,r.style.width=`${$}%`,r.style.height=`${P}%`)},onEnd:()=>i({left:parseFloat(r.style.left),top:parseFloat(r.style.top),width:parseFloat(r.style.width),height:parseFloat(r.style.height)})})})}let Z=!1,A=null,et=-1;function Tt(){p.borderControls.classList.add("hidden"),p.stitchingControls.classList.remove("hidden"),p.stitchingWrapper.classList.remove("hidden"),document.getElementById("stitching-placeholder").classList.toggle("hidden",c.stitching.images.length>0),Ft()}function Rt(){p.stitchingControls.classList.add("hidden"),p.stitchingWrapper.classList.add("hidden"),p.stitchingGrid.removeEventListener("mousedown",pt)}function G(){const t=p.stitchingGrid;t.innerHTML="",t.className="collage-grid",t.classList.add(c.stitching.direction),t.style.position="relative",c.stitching.images.length>1&&t.classList.add("is-sortable"),c.stitching.images.forEach((n,a)=>{const d=w("div","stitched-image-container"),g=w("img");g.src=n,g.dataset.index=a;const i=w("button","delete-stitched-image-btn");i.innerHTML="&times;",i.title="删除图片",i.onclick=s=>{s.stopPropagation(),Gt(a)};const o=w("button","add-stitched-image-btn");o.innerHTML="+",o.title="在此后插入图片",o.onclick=s=>{s.stopPropagation();const l=w("input");l.type="file",l.multiple=!0,l.accept="image/*",l.style.display="none",l.onchange=u=>{u.target.files.length>0&&Nt(u.target.files,a),document.body.removeChild(l)},document.body.appendChild(l),l.click()},d.append(g,i,o),t.appendChild(d)});const e=p.stitchingGrid,r=c.stitching;r.texts.forEach(n=>nt(n,e)),r.arrows.forEach(n=>ct(n,e)),r.rectangles.forEach(n=>j(n,e)),r.ellipses.forEach(n=>j(n,e)),mt()}function Ft(){p.stitchingGrid.addEventListener("mousedown",pt)}function pt(t){if(t.target.tagName!=="IMG"||c.stitching.images.length<2||(t.preventDefault(),Z=!0,A=t.target.closest(".stitched-image-container"),!A))return;const e=A.querySelector("img");et=parseInt(e.dataset.index),A.classList.add("dragging"),document.addEventListener("mousemove",ht),document.addEventListener("mouseup",ft)}function ht(t){if(!Z)return;p.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");e&&e!==A&&e.classList.add("drag-over")}function ft(t){if(!Z)return;A.classList.remove("dragging"),p.stitchingGrid.querySelectorAll(".drag-over").forEach(r=>r.classList.remove("drag-over"));const e=t.target.closest(".stitched-image-container");if(e&&e!==A){const r=e.querySelector("img");if(r){const n=parseInt(r.dataset.index);At(et,n)}}Z=!1,A=null,et=-1,document.removeEventListener("mousemove",ht),document.removeEventListener("mouseup",ft)}function At(t,e){const[r]=c.stitching.images.splice(t,1);c.stitching.images.splice(e,0,r),G()}function Wt(t){const e=Array.from(t).filter(n=>n.type.startsWith("image/"));if(e.length===0){B("未选择有效的图片文件","error");return}document.getElementById("stitching-placeholder").classList.add("hidden");const r=e.map(n=>new Promise(a=>{const d=new FileReader;d.onload=g=>a(g.target.result),d.readAsDataURL(n)}));Promise.all(r).then(n=>{c.stitching.images=c.stitching.images.concat(n),B(`成功添加 ${n.length} 张图片`,"success"),G(),O()})}function Dt(){if(!(c.stitching.images.length<2)){for(let t=c.stitching.images.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[c.stitching.images[t],c.stitching.images[e]]=[c.stitching.images[e],c.stitching.images[t]]}G(),B("图片已随机排序","info")}}function mt(){const{spacing:t,radius:e}=c.shared;p.stitchingWrapper.style.padding=`${t}px`;const r=p.stitchingGrid;r.style.gap=`${t}px`,r.querySelectorAll("img").forEach(n=>{n.style.borderRadius=`${e}px`})}function Ot(){const t=p.stitchingWrapper,e=p.stitchingGrid,r=document.createElement("div"),n=e.cloneNode(!0),a=window.getComputedStyle(t);Object.assign(r.style,{padding:a.padding,backgroundColor:a.backgroundColor,backgroundImage:a.backgroundImage,backgroundSize:a.backgroundSize,backgroundPosition:a.backgroundPosition,boxSizing:"border-box",position:"absolute",top:"-9999px",left:"-9999px"}),n.style.gap=window.getComputedStyle(e).gap,r.appendChild(n),document.body.appendChild(r);const d=()=>{document.body.removeChild(r)};return{element:r,options:{useCORS:!0,backgroundColor:null,scale:3,width:r.offsetWidth,height:r.offsetHeight},cleanup:d}}function yt(t){t!==c.stitching.direction&&(c.stitching.direction=t,document.querySelector("#stitching-direction-btns .active").classList.remove("active"),document.querySelector(`#stitching-direction-btns [data-direction="${t}"]`).classList.add("active"),G())}const zt=Object.freeze(Object.defineProperty({__proto__:null,activate:Tt,applySharedStyles:mt,deactivate:Rt,getDownloadOptions:Ot,processFiles:Wt,render:G,setDirection:yt,shuffle:Dt},Symbol.toStringTag,{value:"Module"}));function M(){return c.currentMode==="layout"?c.layout:c.stitching}function Ht(){var t;(t=k())==null||t.shuffle()}function jt(t){c.shared.downloadQuality=t}function _t(){_(null),W(null),R(null),Y(null),q(null);const t=k();if(!t)return;p.layoutGrid.querySelectorAll(".gutter").forEach(d=>d.style.display="none"),B("正在生成高清晰度图片...","info");const{element:e,options:r,cleanup:n}=t.getDownloadOptions(),a={...r,backgroundColor:null};html2canvas(e,a).then(d=>{n&&n(),p.layoutGrid.querySelectorAll(".gutter").forEach(u=>u.style.display="block");const g=document.createElement("a"),i=c.shared.downloadQuality;let o="jpeg",s=1,l="jpg";switch(i){case"high-jpg":o="jpeg",s=.95,l="jpg";break;case"medium-jpg":o="jpeg",s=.8,l="jpg";break;case"png":o="png",l="png";break}g.download=`${c.currentMode}-collage-${Date.now()}.${l}`,g.href=d.toDataURL(`image/${o}`,s),g.click(),B("图片已成功保存！","success")}).catch(d=>{n&&n(),p.layoutGrid.querySelectorAll(".gutter").forEach(g=>g.style.display="block"),console.error("截图失败:",d),B("截图失败，请重试","error")})}function Yt(t){c.currentMode==="layout"&&Ct(t)}function qt(t){var e;c.currentMode==="layout"&&((e=p.aspectRatioBtns.querySelector(".active"))==null||e.classList.remove("active"),t.classList.add("active"),it(),setTimeout(()=>{var r;return(r=k())==null?void 0:r.render()},100))}function Xt(t){c.currentMode==="stitching"&&yt(t)}function Gt(t){var e;c.currentMode==="stitching"&&(t>-1&&t<c.stitching.images.length&&c.stitching.images.splice(t,1),(e=k())==null||e.render(),O())}function Nt(t,e){if(c.currentMode!=="stitching")return;const r=Array.from(t).filter(a=>a.type.startsWith("image/"));if(r.length===0)return;const n=r.map(a=>new Promise(d=>{const g=new FileReader;g.onload=i=>d(i.target.result),g.readAsDataURL(a)}));Promise.all(n).then(a=>{var d;c.stitching.images.splice(e+1,0,...a),B(`成功插入 ${a.length} 张图片`,"success"),(d=k())==null||d.render(),O()})}function Ut(t){const e=k();e&&e.processFiles&&e.processFiles(t)}function Vt(t){const e=new FileReader;e.onload=r=>{c.shared.backgroundImage=r.target.result,T()},e.readAsDataURL(t)}function Qt(){c.shared.backgroundImage=null,T()}function Zt(){var a;const t=M(),r=window.innerWidth<768?16:24,n={id:Date.now(),content:"文字",color:"#ff0000",fontSize:r,top:30,left:30};t.texts.push(n),(a=k())==null||a.render(),W(n.id)}function W(t){var r;if(c.shared.selectedTextId===t)return;const e=c.shared.selectedTextId;if(c.shared.selectedTextId=t,e&&((r=document.getElementById(`text-container-${e}`))==null||r.classList.remove("selected")),t){const n=document.getElementById(`text-container-${t}`);if(n){n.classList.add("selected");const a=n.querySelector(".text-content");Kt(a)}}}function tt(t){if(!c.shared.selectedTextId)return;const e=M().texts.find(a=>a.id===c.shared.selectedTextId);if(!e)return;Object.assign(e,t);const r=document.getElementById(`text-container-${e.id}`);if(!r)return;const n=r.querySelector(".text-content");n&&(t.content&&(n.innerText=t.content),t.fontSize&&(n.style.fontSize=`${t.fontSize}px`),t.color&&(n.style.color=t.color),t.top&&(n.style.top=`${t.top}%`),t.left&&(n.style.left=`${t.left}%`))}function vt(){var r;if(!c.shared.selectedTextId)return;const t=M(),e=t.texts.findIndex(n=>n.id===c.shared.selectedTextId);e>-1&&(t.texts.splice(e,1),(r=document.getElementById(`text-container-${c.shared.selectedTextId}`))==null||r.remove(),W(null))}function Kt(t){if(t&&(t.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u")){const e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const r=window.getSelection();r.removeAllRanges(),r.addRange(e)}}function Jt(){var a;const t=M(),e=window.innerWidth<768,r={strokeWidth:e?4:3,x1:e?20:25,y1:25,x2:e?45:35,y2:35},n={id:Date.now(),color:"#ff0000",rotation:0,...r};t.arrows.push(n),(a=k())==null||a.render(),R(n.id)}function R(t){var r,n;if(c.shared.selectedArrowId===t&&t!==null)return;const e=c.shared.selectedArrowId;c.shared.selectedArrowId=t,e&&((r=document.getElementById(`arrow-container-${e}`))==null||r.classList.remove("selected")),t&&((n=document.getElementById(`arrow-container-${t}`))==null||n.classList.add("selected"))}function U(t){if(!c.shared.selectedArrowId)return;const e=M().arrows.find(r=>r.id===c.shared.selectedArrowId);e&&Object.assign(e,t)}function bt(){var r;if(!c.shared.selectedArrowId)return;const t=M(),e=t.arrows.findIndex(n=>n.id===c.shared.selectedArrowId);e>-1&&(t.arrows.splice(e,1),(r=k())==null||r.render(),R(null))}function te(){var n;const t=M(),e=window.innerWidth<768,r={id:Date.now(),type:"rectangle",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?15:10,rotation:0};t.rectangles.push(r),(n=k())==null||n.render(),Y(r.id)}function Y(t){var r,n;if(c.shared.selectedRectangleId===t)return;W(null),R(null),q(null);const e=c.shared.selectedRectangleId;c.shared.selectedRectangleId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((n=document.getElementById(`shape-container-${t}`))==null||n.classList.add("selected"))}function ee(t){if(!c.shared.selectedRectangleId)return;const e=M().rectangles.find(r=>r.id===c.shared.selectedRectangleId);e&&Object.assign(e,t)}function wt(){var r;if(!c.shared.selectedRectangleId)return;const t=M(),e=t.rectangles.findIndex(n=>n.id===c.shared.selectedRectangleId);e>-1&&(t.rectangles.splice(e,1),(r=k())==null||r.render(),Y(null))}function re(){var n;const t=M(),e=window.innerWidth<768,r={id:Date.now(),type:"ellipse",color:"#ff0000",strokeWidth:4,left:30,top:30,width:e?20:15,height:e?20:15,rotation:0};t.ellipses.push(r),(n=k())==null||n.render(),q(r.id)}function q(t){var r,n;if(c.shared.selectedEllipseId===t)return;W(null),R(null),Y(null);const e=c.shared.selectedEllipseId;c.shared.selectedEllipseId=t,e&&((r=document.getElementById(`shape-container-${e}`))==null||r.classList.remove("selected")),t&&((n=document.getElementById(`shape-container-${t}`))==null||n.classList.add("selected"))}function ne(t){if(!c.shared.selectedEllipseId)return;const e=M().ellipses.find(r=>r.id===c.shared.selectedEllipseId);e&&Object.assign(e,t)}function Et(){var r;if(!c.shared.selectedEllipseId)return;const t=M(),e=t.ellipses.findIndex(n=>n.id===c.shared.selectedEllipseId);e>-1&&(t.ellipses.splice(e,1),(r=k())==null||r.render(),q(null))}function _(t){if(c.currentMode==="layout"&&c.layout.activeCellId!==t){if(c.layout.activeCellId){const e=document.getElementById(c.layout.activeCellId);e&&e.classList.remove("selected")}if(c.layout.activeCellId=t,t){const e=document.getElementById(t);e&&e.classList.add("selected")}}}function ce(t){if(typeof t!="string"||t.trim()==="")return[50,50];const e=t.split(" "),r=parseFloat(e[0]),n=e.length>1?parseFloat(e[1]):r;return[isNaN(r)?50:r,isNaN(n)?50:n]}function oe(t,e){if(c.currentMode!=="layout")return;const{activeCellId:r}=c.layout;if(!r)return;const n=c.layout.imagesData[r];if(!n||!n.src)return;const a=document.getElementById(r);if(!a)return;const[d,g]=ce(n.position);let i=d-t,o=g-e;i=Math.max(0,Math.min(100,i)),o=Math.max(0,Math.min(100,o));const s=`${i}% ${o}%`;n.position=s,a.style.backgroundPosition=s}function K(t){if(c.currentMode!=="layout")return;const{activeCellId:e}=c.layout;if(!e)return;const r=c.layout.imagesData[e];if(!r||!r.src)return;const n=Math.max(1,Math.min(t,5));r.scale=n,D(e,r)}function ie(t){c.currentMode==="layout"&&(delete c.layout.imagesData[t],J(t),_(null),O())}const Lt=.2;function se(){if(c.currentMode!=="layout")return;const{activeCellId:t}=c.layout;if(!t||!c.layout.imagesData[t])return;const r=(c.layout.imagesData[t].scale||1)+Lt;K(r)}function ae(){if(c.currentMode!=="layout")return;const{activeCellId:t}=c.layout;if(!t||!c.layout.imagesData[t])return;const r=(c.layout.imagesData[t].scale||1)-Lt;K(r)}function le(t){if(c.currentMode!=="layout")return;const e=c.layout.imagesData[t];e&&(e.scale=1,e.position="50% 50%",D(t,e))}function ot(){const t=p.layoutGrid;t.querySelectorAll(".gutter").forEach(g=>g.remove());const[e,r]=c.layout.layoutDef.gr,n=t.getBoundingClientRect(),a=c.layout.rowFractions.reduce((g,i)=>g+i,0),d=c.layout.colFractions.reduce((g,i)=>g+i,0);if(r>1){const g=c.layout.colFractions.map(o=>o/d*n.width);let i=0;for(let o=0;o<r-1;o++){i+=g[o];const s=w("div","gutter gutter-v");s.style.left=`${i}px`,s.style.height="100%",s.dataset.index=o,t.appendChild(s),gt(s,"v")}}if(e>1){const g=c.layout.rowFractions.map(o=>o/a*n.height);let i=0;for(let o=0;o<e-1;o++){i+=g[o];const s=w("div","gutter gutter-h");s.style.top=`${i}px`,s.style.width="100%",s.dataset.index=o,t.appendChild(s),gt(s,"h")}}}function gt(t,e){t.onmousedown=function(r){r.preventDefault();const n=p.layoutGrid,a=parseInt(t.dataset.index),d=n.getBoundingClientRect(),g=function(o){if(e==="v"){const s=c.layout.colFractions[a]+c.layout.colFractions[a+1],l=c.layout.colFractions.slice(0,a).reduce((f,b)=>f+b/c.layout.colFractions.reduce((L,C)=>L+C,0)*d.width,0);let m=(o.clientX-d.left-l)/d.width*c.layout.colFractions.reduce((f,b)=>f+b,0);m<.1&&(m=.1);let v=s-m;v<.1&&(v=.1,m=s-.1),c.layout.colFractions[a]=m,c.layout.colFractions[a+1]=v,n.style.gridTemplateColumns=c.layout.colFractions.map(f=>`${f}fr`).join(" ")}else{const s=c.layout.rowFractions[a]+c.layout.rowFractions[a+1],l=c.layout.rowFractions.slice(0,a).reduce((f,b)=>f+b/c.layout.rowFractions.reduce((L,C)=>L+C,0)*d.height,0);let m=(o.clientY-d.top-l)/d.height*c.layout.rowFractions.reduce((f,b)=>f+b,0);m<.1&&(m=.1);let v=s-m;v<.1&&(v=.1,m=s-.1),c.layout.rowFractions[a]=m,c.layout.rowFractions[a+1]=v,n.style.gridTemplateRows=c.layout.rowFractions.map(f=>`${f}fr`).join(" ")}},i=function(){document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",i),setTimeout(ot,50)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",i)}}const de=Object.freeze(Object.defineProperty({__proto__:null,createGutters:ot},Symbol.toStringTag,{value:"Module"}));function ge(){p.layoutControls.classList.remove("hidden"),p.canvasSettings.classList.remove("hidden"),p.borderControls.classList.remove("hidden"),p.layoutWrapper.classList.remove("hidden"),p.canvasHint.classList.remove("hidden")}function ue(){p.layoutControls.classList.add("hidden"),p.canvasSettings.classList.add("hidden"),p.layoutWrapper.classList.add("hidden"),p.canvasHint.classList.add("hidden")}function St(){const t=p.layoutGrid;t.innerHTML="";const e=c.layout.layoutDef;if(!e)return;const[r,n]=e.gr;c.layout.rowFractions=Array(r).fill(1),c.layout.colFractions=Array(n).fill(1),t.style.gridTemplateRows=c.layout.rowFractions.map(o=>`${o}fr`).join(" "),t.style.gridTemplateColumns=c.layout.colFractions.map(o=>`${o}fr`).join(" ");const a=e.c||Array.from({length:r*n},()=>({r:1,c:1})),d={...c.layout.imagesData},g={};a.forEach((o,s)=>{const l=`cell-${s}`,u=fe(l);if(u.style.gridRowEnd=`span ${o.r}`,u.style.gridColumnEnd=`span ${o.c}`,o.s&&(u.style.gridRowStart=o.s[0],u.style.gridColumnStart=o.s[1]),t.appendChild(u),d[l]){g[l]=d[l];const m=g[l];D(l,m)}}),c.layout.imagesData=g;const i=p.layoutGrid;c.layout.texts.forEach(o=>nt(o,i)),c.layout.arrows.forEach(o=>ct(o,i)),c.layout.rectangles.forEach(o=>j(o,i)),c.layout.ellipses.forEach(o=>j(o,i)),It(),setTimeout(ot,100)}function xt(t,e=null){var i;const r=Array.from(t).filter(o=>o.type.startsWith("image/"));if(r.length===0){B("未选择有效的图片文件","error");return}const n=(o,s)=>{const l=new FileReader;l.onload=u=>{const m=u.target.result,v=new Image;v.onload=()=>{const f={src:m,position:"50% 50%",scale:1,width:v.naturalWidth,height:v.naturalHeight};c.layout.imagesData[s]=f,D(s,f)},v.src=m},l.readAsDataURL(o)},a=[];e&&a.push(e),Array.from(document.querySelectorAll("#layout-grid .grid-cell")).map(o=>o.id).forEach(o=>{o!==e&&(!c.layout.imagesData[o]||!c.layout.imagesData[o].src)&&a.push(o)});const g=e&&((i=c.layout.imagesData[e])==null?void 0:i.src);if(a.length>0){const o=Math.min(r.length,a.length);B(`正在上传 ${o} 张图片...`,"info");let s=0;for(let l=0;l<o;l++)n(r[l],a[l]),s++;setTimeout(()=>{const l=`成功上传 ${s} 张图片。`+(r.length>s?` 已忽略 ${r.length-s} 张。`:"");B(l,"success"),O()},500)}else g?(B("画布已满，将替换当前图片。","info"),n(r[0],e)):B("没有空的格子可以放置图片","error")}function pe(){const t=Object.entries(c.layout.imagesData);if(t.length<2)return;const e=t.map(r=>r[1]);for(let r=e.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[e[r],e[n]]=[e[n],e[r]]}t.forEach(([r],n)=>{c.layout.imagesData[r]=e[n],D(r,e[n].src,e[n].position)}),B("图片已随机排序","info")}function It(){const{spacing:t,radius:e}=c.shared,r=p.layoutGrid;r.style.padding=`${t}px`,r.style.gap=`${t}px`,r.querySelectorAll(".grid-cell").forEach(n=>{n.style.borderRadius=`${e}px`})}function he(){const e=p.layoutWrapper,r=e.offsetWidth;if(!r)return{element:document.createElement("div"),options:{},cleanup:()=>{}};const n=Math.max(1,1600/r),a=r*n,d=window.getComputedStyle(e),g=parseFloat(d.width)/parseFloat(d.height),i=a/g,o=document.createElement("div");Object.assign(o.style,{position:"absolute",top:"-9999px",left:"-9999px",width:`${a}px`,height:`${i}px`});const s=e.cloneNode(!0),l=s.querySelector("#layout-grid");l.querySelectorAll(".text-element-container, .arrow-container, .shape-container").forEach(h=>h.remove()),s.style.boxSizing="border-box",s.style.width=`${a}px`,s.style.height=`${i}px`,s.style.backgroundColor=c.shared.bgColor,s.style.backgroundImage=c.shared.backgroundImage?`url(${c.shared.backgroundImage})`:"none",s.style.backgroundSize="cover",s.style.backgroundPosition="center";const u=c.shared.borderWidths||{top:0,right:0,bottom:0,left:0};if(s.style.paddingTop=`${u.top*n}px`,s.style.paddingRight=`${u.right*n}px`,s.style.paddingBottom=`${u.bottom*n}px`,s.style.paddingLeft=`${u.left*n}px`,l){l.style.boxSizing="border-box";const{spacing:h,radius:y}=c.shared,E=h*n,S=y*n;l.style.padding=`${E}px`,l.style.gap=`${E}px`,l.style.display="grid",l.style.gridTemplateRows=c.layout.rowFractions.map(x=>`${x}fr`).join(" "),l.style.gridTemplateColumns=c.layout.colFractions.map(x=>`${x}fr`).join(" "),l.querySelectorAll(".grid-cell").forEach(x=>{x.style.borderRadius=`${S}px`})}const m=parseFloat(s.style.paddingLeft)||0,v=parseFloat(s.style.paddingRight)||0,f=parseFloat(s.style.paddingTop)||0,b=parseFloat(s.style.paddingBottom)||0,L={width:a-m-v,height:i-f-b};return c.layout.texts.forEach(h=>nt({...h,fontSize:h.fontSize*n},l)),c.layout.arrows.forEach(h=>ct({...h,strokeWidth:h.strokeWidth*n},l,L)),c.layout.rectangles.forEach(h=>j({...h,strokeWidth:h.strokeWidth*n},l)),c.layout.ellipses.forEach(h=>j({...h,strokeWidth:h.strokeWidth*n},l)),o.appendChild(s),document.body.appendChild(o),{element:s,options:{useCORS:!0,backgroundColor:null,scale:2},cleanup:()=>{document.body.removeChild(o)}}}function Ct(t){var e,r;t!==c.layout.currentLayoutId&&((e=p.layoutContainer.querySelector(".active"))==null||e.classList.remove("active"),(r=p.layoutContainer.querySelector(`[data-layout="${t}"]`))==null||r.classList.add("active"),Mt(t),St())}function kt(t,e){if(!e)return;const r=c.layout.imagesData[t]?{...c.layout.imagesData[t]}:null,n=c.layout.imagesData[e]?{...c.layout.imagesData[e]}:null;r&&(r.position="50% 50%",r.scale=1),n&&(n.position="50% 50%",n.scale=1),c.layout.imagesData[t]=n,n?D(t,n):(delete c.layout.imagesData[t],J(t)),c.layout.imagesData[e]=r,r?D(e,r):(delete c.layout.imagesData[e],J(e))}function fe(t){const e=w("div","grid-cell");e.id=t;const r=w("input");r.type="file",r.accept="image/*",r.id=`input-${t}`,r.multiple=!0,r.className="hidden-file-input",r.onchange=u=>{u.target.files.length>0&&xt(u.target.files,t),u.target.value=null};const n=w("div","upload-icon-container");n.innerHTML=H.upload;const a=w("div","cell-button-container"),d=w("div","cell-icon-btn zoom-in-btn");d.innerHTML=H.zoomIn,d.title="放大";const g=w("div","cell-icon-btn zoom-out-btn");g.innerHTML=H.zoomOut,g.title="缩小";const i=w("div","cell-icon-btn reset-btn");i.innerHTML=H.zoomReset,i.title="还原";const o=w("div","cell-icon-btn replace-btn");o.innerHTML=H.replace,o.title="替换图片";const s=w("div","cell-icon-btn remove-btn");s.innerHTML=H.remove,s.title="删除图片",d.onclick=u=>{u.stopPropagation(),_(t),se()},g.onclick=u=>{u.stopPropagation(),_(t),ae()},i.onclick=u=>{u.stopPropagation(),le(t)},o.onclick=u=>{u.stopPropagation(),r.click()},s.onclick=u=>{u.stopPropagation(),ie(t)},a.append(d,g,i,o,s),e.append(n,r,a),e.addEventListener("wheel",u=>{var L;if(e.id!==c.layout.activeCellId||!e.classList.contains("has-image"))return;u.preventDefault(),u.stopPropagation();const m=((L=c.layout.imagesData[e.id])==null?void 0:L.scale)||1,v=.1,f=u.deltaY<0?1:-1,b=m+f*v;K(b)},{passive:!1});const l={isPinching:!1,initialDistance:0,initialScale:1};return e.addEventListener("touchstart",u=>{var m;u.touches.length===2&&e.id===c.layout.activeCellId&&(u.preventDefault(),l.isPinching=!0,l.initialDistance=Math.hypot(u.touches[0].pageX-u.touches[1].pageX,u.touches[0].pageY-u.touches[1].pageY),l.initialScale=((m=c.layout.imagesData[e.id])==null?void 0:m.scale)||1)},{passive:!1}),e.addEventListener("touchmove",u=>{if(l.isPinching&&u.touches.length===2){u.preventDefault();const v=Math.hypot(u.touches[0].pageX-u.touches[1].pageX,u.touches[0].pageY-u.touches[1].pageY)/l.initialDistance,f=l.initialScale*v,b=Math.max(1,Math.min(f,5));e.style.backgroundSize=`${b*100}%`}},{passive:!1}),e.addEventListener("touchend",u=>{if(l.isPinching){const m=parseFloat(e.style.backgroundSize)/100;K(m),l.isPinching=!1,l.initialDistance=0,l.initialScale=1}}),e}const me=Object.freeze(Object.defineProperty({__proto__:null,activate:ge,applySharedStyles:It,deactivate:ue,getDownloadOptions:he,processFiles:xt,render:St,selectNewLayout:Ct,shuffle:pe,swapImages:kt},Symbol.toStringTag,{value:"Module"})),ye={layout:me,stitching:zt};let F=null;function k(){return F}function rt(t){c.currentMode===t&&F||(F&&F.deactivate(),c.currentMode=t,F=ye[t],F.activate(),p.layoutModeBtn.classList.toggle("active",t==="layout"),p.stitchingModeBtn.classList.toggle("active",t==="stitching"),ve(),O())}function ve(){F&&F.render()}let ut;function B(t,e="info",r=3e3){const n=document.getElementById("toast");n&&(clearTimeout(ut),n.textContent=t,n.className="toast",n.classList.add(e),n.classList.add("show"),ut=setTimeout(()=>{n.classList.remove("show")},r))}const V=t=>{const e=parseInt(t.value,10);return isNaN(e)||e<0?0:e};function T(){var o;const t=p.spacingSlider.value,e=p.radiusSlider.value,r=p.colorPicker.value,n=V(p.borderTopInput),a=V(p.borderRightInput),d=V(p.borderBottomInput),g=V(p.borderLeftInput);c.shared.spacing=t,c.shared.radius=e,c.shared.bgColor=r,c.shared.borderWidths={top:n,right:a,bottom:d,left:g},p.spacingValue.textContent=t,p.radiusValue.textContent=e,[p.layoutWrapper,p.stitchingWrapper].forEach(s=>{c.shared.backgroundImage?(s.style.backgroundImage=`url(${c.shared.backgroundImage})`,s.style.backgroundSize="cover",s.style.backgroundPosition="center"):(s.style.backgroundImage="none",s.style.backgroundColor=c.shared.bgColor),s.style.paddingTop=`${c.shared.borderWidths.top}px`,s.style.paddingRight=`${c.shared.borderWidths.right}px`,s.style.paddingBottom=`${c.shared.borderWidths.bottom}px`,s.style.paddingLeft=`${c.shared.borderWidths.left}px`}),(o=k())==null||o.applySharedStyles()}function D(t,e){const r=document.getElementById(t);if(!r||!e||!e.src)return;r.style.backgroundImage=`url('${e.src}')`,r.style.backgroundPosition=e.position,r.classList.add("has-image");const n=r.querySelector(".upload-icon-container");n&&(n.style.display="none");const a=r.clientWidth,d=r.clientHeight;if(!e.width||!e.height||!a||!d){r.style.backgroundSize="cover";return}const g=a/d,i=e.width/e.height,o=e.scale||1;let s;i>g?s=`auto ${o*100}%`:s=`${o*100}% auto`,r.style.backgroundSize=s}function J(t){const e=document.getElementById(t);if(!e)return;e.style.backgroundImage="none",e.classList.remove("has-image");const r=e.querySelector(".upload-icon-container");r&&(r.style.display="flex")}function O(){let t=0;c.currentMode==="layout"?t=Object.keys(c.layout.imagesData).length:t=c.stitching.images.length,p.shuffleBtn.disabled=t<2}function it(){const t=document.getElementById("center-content"),e=document.getElementById("layout-wrapper"),r=document.getElementById("aspect-ratio-btns"),n=document.getElementById("canvas-action-toolbar");if(!t||!e||!r||!n){console.error("无法找到布局容器或工具栏元素，计算中止。");return}const a=window.getComputedStyle(t),d=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight),g=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),i=t.clientWidth-d;let o=t.clientHeight-g;const s=window.getComputedStyle(n),l=n.offsetHeight+parseFloat(s.marginBottom);o-=l;const u=r.querySelector(".active");if(!u)return;const m=u.dataset.ratio.split("/"),v=parseFloat(m[0])/parseFloat(m[1]);let f,b;i/o>v?(b=o,f=b*v):(f=i,b=f/v),e.style.width=`${f}px`,e.style.height=`${b}px`,n.style.width=`${f}px`}const be=Object.freeze(Object.defineProperty({__proto__:null,applyCanvasStyles:T,applyImageToCell:D,clearImageFromCell:J,showToast:B,updateCanvasSize:it,updateShuffleButton:O},Symbol.toStringTag,{value:"Module"}));(function(){const t="img.ops-coffee.cn",e=window.location.hostname;e&&e!==t&&e!=="localhost"&&(window.location.href=`https://${t}`)})();function we(){p.layoutContainer.innerHTML="";const t={};for(const e in Q){const r=Q[e];t[r.g]||(t[r.g]=[]),t[r.g].push({id:e,...r})}Object.keys(t).sort((e,r)=>e-r).forEach(e=>{const r=w("h4","layout-group-title");r.textContent=`${e} 张图片`,p.layoutContainer.appendChild(r);const n=w("div","layout-thumbnail-grid");t[e].forEach(a=>{const d=Ee(a.id,a);a.id===c.layout.currentLayoutId&&d.classList.add("active"),n.appendChild(d)}),p.layoutContainer.appendChild(n)})}function Ee(t,e){const r=w("div","layout-thumbnail");r.dataset.layout=t;const n=w("div","thumbnail-grid");return n.style.gridTemplateColumns=`repeat(${e.gr[1]}, 1fr)`,n.style.gridTemplateRows=`repeat(${e.gr[0]}, 1fr)`,(e.c||Array.from({length:e.gr[0]*e.gr[1]},()=>({r:1,c:1}))).forEach(d=>{const g=w("div","thumbnail-cell");g.style.gridRowEnd=`span ${d.r}`,g.style.gridColumnEnd=`span ${d.c}`,d.s&&(g.style.gridRowStart=d.s[0],g.style.gridColumnStart=d.s[1]),n.appendChild(g)}),r.appendChild(n),r}function Le(){p.layoutModeBtn.addEventListener("click",()=>rt("layout")),p.stitchingModeBtn.addEventListener("click",()=>rt("stitching")),p.stitchingUploadBtn.addEventListener("click",()=>p.stitchingUploadInput.click()),p.stitchingUploadInput.addEventListener("change",i=>Ut(i.target.files)),p.stitchingDirectionBtns.addEventListener("click",i=>{const o=i.target.closest("button");o&&Xt(o.dataset.direction)}),p.layoutContainer.addEventListener("click",i=>{const o=i.target.closest(".layout-thumbnail");o&&(Yt(o.dataset.layout),document.getElementById("left-sidebar").classList.contains("is-open")&&document.getElementById("mobile-overlay").click())}),p.aspectRatioBtns.addEventListener("click",i=>{const o=i.target.closest("button");o&&qt(o)}),p.spacingSlider.addEventListener("input",T),p.radiusSlider.addEventListener("input",T),p.borderTopInput.addEventListener("input",T),p.borderRightInput.addEventListener("input",T),p.borderBottomInput.addEventListener("input",T),p.borderLeftInput.addEventListener("input",T),p.colorPicker.addEventListener("input",T),p.downloadBtn.addEventListener("click",_t);const t=document.getElementById("bg-upload-input");document.getElementById("upload-bg-btn").addEventListener("click",()=>t.click()),t.addEventListener("change",i=>{i.target.files&&i.target.files[0]&&Vt(i.target.files[0])}),document.getElementById("remove-bg-btn").addEventListener("click",Qt),document.getElementById("add-text-btn").addEventListener("click",Zt),document.getElementById("add-arrow-btn").addEventListener("click",Jt),document.getElementById("add-rectangle-btn").addEventListener("click",te),document.getElementById("add-ellipse-btn").addEventListener("click",re),document.getElementById("shuffle-btn").addEventListener("click",Ht);let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{c.currentMode==="layout"&&(lt(async()=>{const{updateCanvasSize:i}=await Promise.resolve().then(()=>be);return{updateCanvasSize:i}},void 0).then(({updateCanvasSize:i})=>i()),lt(async()=>{const{createGutters:i}=await Promise.resolve().then(()=>de);return{createGutters:i}},void 0).then(({createGutters:i})=>i()))},150)});const r=document.getElementById("left-sidebar"),n=document.getElementById("right-sidebar"),a=document.getElementById("mobile-overlay"),d=()=>{r.classList.remove("is-open"),n.classList.remove("is-open"),a.classList.add("hidden"),document.body.classList.remove("sidebar-open")};document.getElementById("toggle-left-sidebar").addEventListener("click",i=>{i.stopPropagation(),r.classList.toggle("is-open")?(n.classList.remove("is-open"),a.classList.remove("hidden"),document.body.classList.add("sidebar-open")):d()}),document.getElementById("toggle-right-sidebar").addEventListener("click",i=>{i.stopPropagation(),n.classList.toggle("is-open")?(r.classList.remove("is-open"),a.classList.remove("hidden"),document.body.classList.add("sidebar-open")):d()}),a.addEventListener("click",d);const g=document.getElementById("app-container");document.getElementById("pc-toggle-left").addEventListener("click",()=>g.classList.toggle("left-sidebar-collapsed")),document.getElementById("pc-toggle-right").addEventListener("click",()=>g.classList.toggle("right-sidebar-collapsed")),document.getElementById("stitching-placeholder").addEventListener("click",()=>p.stitchingUploadInput.click()),Se(),document.addEventListener("click",i=>{const o=i.target,s=o.closest(".grid-cell, .text-element-container, .arrow-container, .shape-container"),l=o.closest("#right-sidebar"),u=o.closest("#canvas-action-toolbar");s||l||u||(_(null),W(null),R(null),Y(null),q(null))}),document.addEventListener("keydown",i=>{const o=i.target;if(!(o.isContentEditable||o.tagName==="INPUT"||o.tagName==="TEXTAREA")){if(i.key==="Delete"||i.key==="Backspace"){i.preventDefault(),c.shared.selectedTextId?vt():c.shared.selectedArrowId?bt():c.shared.selectedRectangleId?wt():c.shared.selectedEllipseId&&Et();return}if(c.currentMode==="layout"&&c.layout.activeCellId){let l=0,u=0;switch(i.key){case"ArrowUp":u=-1.5;break;case"ArrowDown":u=1.5;break;case"ArrowLeft":l=-1.5;break;case"ArrowRight":l=1.5;break;default:return}i.preventDefault(),oe(l,u)}}})}function Se(){const t=document.getElementById("layout-grid");let e={};function r(){e.startCell&&e.startCell.classList.remove("dragging"),e.activeCell&&e.activeCell.classList.remove("is-panning"),e={isMouseDown:!1,isPanning:!1,isDragging:!1,hasMoved:!1,startCell:null,activeCell:null,startX:0,startY:0,startBgPercentX:0,startBgPercentY:0},document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",g)}function n(i,o){if(typeof i!="string")return 50;const s=i.trim();if(s.endsWith("%"))return parseFloat(s);if(s.endsWith("px"))return parseFloat(s)/o*100;switch(s){case"top":case"left":return 0;case"bottom":case"right":return 100;case"center":return 50}return 50}t.addEventListener("mousedown",i=>{if(i.button!==0)return;const o=i.target.closest(".grid-cell");!o||i.target.closest(".remove-image-btn")||(r(),e.isMouseDown=!0,e.startCell=o,e.startX=i.clientX,e.startY=i.clientY,document.addEventListener("mousemove",d),document.addEventListener("mouseup",g))});let a=null;function d(i){var o,s;if(e.isMouseDown){if(e.isPanning){const l=e.activeCell.getBoundingClientRect(),u=(i.clientX-e.startX)/l.width*100,m=(i.clientY-e.startY)/l.height*100;let v=e.startBgPercentX-u,f=e.startBgPercentY-m;v=Math.max(0,Math.min(100,v)),f=Math.max(0,Math.min(100,f)),e.activeCell.style.backgroundPosition=`${v}% ${f}%`;return}if(e.isDragging){const l=(o=document.elementFromPoint(i.clientX,i.clientY))==null?void 0:o.closest(".grid-cell");l!==a&&(a&&a.classList.remove("drag-over"),l&&l!==e.startCell&&l.classList.add("drag-over"),a=l);return}if(!e.hasMoved&&(Math.abs(i.clientX-e.startX)>5||Math.abs(i.clientY-e.startY)>5))if(e.hasMoved=!0,i.altKey&&e.startCell.classList.contains("has-image")){e.isPanning=!0,e.activeCell=e.startCell,e.activeCell.classList.add("is-panning");const l=e.activeCell.id,m=(((s=c.layout.imagesData[l])==null?void 0:s.position)||"50% 50%").split(" "),v=e.activeCell.getBoundingClientRect();e.startBgPercentX=n(m[0],v.width),e.startBgPercentY=n(m.length>1?m[1]:m[0],v.height)}else e.startCell.classList.contains("has-image")&&(e.isDragging=!0,e.startCell.classList.add("dragging"))}}function g(i){var o;if(e.isMouseDown){if(e.isPanning){const s=e.activeCell.id;c.layout.imagesData[s]&&(c.layout.imagesData[s].position=e.activeCell.style.backgroundPosition)}else if(e.isDragging){const s=(o=document.elementFromPoint(i.clientX,i.clientY))==null?void 0:o.closest(".grid-cell");s&&s!==e.startCell&&kt(e.startCell.id,s.id)}else if(!e.hasMoved)if(e.startCell.classList.contains("has-image"))_(e.startCell.id);else{const s=e.startCell.querySelector('input[type="file"]');s&&s.click()}a&&(a.classList.remove("drag-over"),a=null),r()}}}function xe(){var n;const t=document.getElementById("quality-selector");if(!t)return;const e=c.shared.downloadQuality,r=t.querySelector(`[data-quality="${e}"]`);r&&((n=t.querySelector(".active"))==null||n.classList.remove("active"),r.classList.add("active")),t.addEventListener("click",a=>{var g;const d=a.target.closest("button");!d||!d.dataset.quality||((g=t.querySelector(".active"))==null||g.classList.remove("active"),d.classList.add("active"),jt(d.dataset.quality))})}function Ie(){Pt(),we(),Le(),rt("layout");const t=p.aspectRatioBtns.querySelector('[data-ratio="1/1"]');t&&t.classList.add("active"),T(),it(),O(),xe(),console.log("%c 免费在线拼图工具 %c by ops-coffee.cn ","background: #0052cc; color: #fff; padding: 5px; border-radius: 5px 0 0 5px;","background: #f4f5f7; color: #42526e; padding: 5px; border-radius: 0 5px 5px 0;"),console.log("感谢使用！如果您对这个工具有任何建议，欢迎联系我们。微信公众号搜索：运维咖啡吧")}document.addEventListener("DOMContentLoaded",Ie);
